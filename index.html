<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Single Test - Trade, Craftsmanship and Urban Life</title>
<style>
/* (STYLES KEPT EXACTLY AS ORIGINAL) */
    * { box-sizing: border-box; }
    body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
            "Segoe UI", Arial, sans-serif;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at 0% 0%, #38bdf8 0, transparent 45%),
                    radial-gradient(circle at 100% 100%, #a855f7 0, transparent 45%),
                    radial-gradient(circle at 0% 100%, #22c55e 0, transparent 40%),
                    #020617;
        color: #0f172a;
    }
    .shell {
        width: 100%;
        max-width: 900px;
        padding: 20px;
    }
    .card {
        position: relative;
        background: rgba(15, 23, 42, 0.82);
        border-radius: 24px;
        padding: 24px 26px 22px;
        box-shadow: 0 22px 60px rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.35);
        backdrop-filter: blur(18px);
        color: #e5e7eb;
        overflow: hidden;
    }
    .card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.18), transparent 55%),
                    radial-gradient(circle at 100% 100%, rgba(168, 85, 247, 0.18), transparent 55%);
        opacity: 0.9;
        pointer-events: none;
    }
    .card-inner { position: relative; z-index: 1; }
    h1 {
        margin: 0 0 3px;
        text-align: center;
        font-size: 1.45rem;
        font-weight: 700;
        letter-spacing: 0.02em;
        color: #f9fafb;
    }
    .tagline {
        text-align:center;
        font-size:0.9rem;
        color:#9ca3af;
        margin-bottom:16px;
    }
    .pill-row {
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:8px;
        margin-bottom:14px;
        font-size:0.8rem;
        color:#9ca3af;
    }
    .pill {
        padding:5px 11px;
        border-radius:999px;
        border:1px solid rgba(148,163,184,0.6);
        background:rgba(15,23,42,0.8);
        display:inline-flex;
        align-items:center;
        gap:6px;
    }
    .pill span.dot {
        display:inline-block;
        width:7px;
        height:7px;
        border-radius:50%;
        background:#22c55e;
    }
    .progress-wrap { margin-bottom:10px; }
    .progress-bar-bg {
        width:100%;
        height:9px;
        border-radius:999px;
        background:rgba(15,23,42,0.9);
        border:1px solid rgba(55,65,81,0.9);
        overflow:hidden;
    }
    .progress-bar-fill {
        height:100%;
        width:0%;
        border-radius:999px;
        background:linear-gradient(90deg,#22c55e,#38bdf8,#a855f7);
        box-shadow:0 0 8px rgba(56,189,248,0.8);
        transition:width 0.28s ease;
    }
    .progress-label {
        margin-top:4px;
        font-size:0.78rem;
        text-align:right;
        color:#9ca3af;
    }
    .question-block { margin-top:12px; }
    .question-text { 
        margin-bottom:12px;
        font-size:1.02rem;
        font-weight:600;
        color:#e5e7eb;
    }
    .options { margin-top:10px; }
    .option {
        border-radius:14px;
        border:1px solid rgba(148,163,184,0.5);
        padding:9px 11px 8px;
        margin-bottom:8px;
        display:flex;
        align-items:flex-start;
        gap:8px;
        cursor:pointer;
        background:radial-gradient(circle at 0 0,rgba(148,163,184,0.18),transparent 60%);
        transition:border-color 0.15s ease,transform 0.05s ease,background 0.15s ease;
    }
    .option:hover {
        border-color:#38bdf8;
        transform:translateY(-1px);
        background:radial-gradient(circle at 0 0,rgba(56,189,248,0.22),transparent 65%);
    }
    .option input {
        margin-top:4px;
        accent-color:#38bdf8;
        cursor:pointer;
    }
    .option-text { font-size:0.95rem; color:#e5e7eb; }
    .short-answer {
        width:100%;
        margin-top:8px;
        padding:10px 12px;
        border-radius:14px;
        border:1px solid rgba(148,163,184,0.7);
        background:rgba(15,23,42,0.8);
        color:#e5e7eb;
        font-size:0.97rem;
        outline:none;
        transition:border-color 0.15s ease,box-shadow 0.15s ease,background 0.15s ease;
    }
    .short-answer::placeholder { color:#6b7280; }
    .short-answer:focus {
        border-color:#38bdf8;
        box-shadow:0 0 0 1px rgba(56,189,248,0.55);
        background:rgba(15,23,42,0.95);
    }
    .nav-row {
        margin-top:18px;
        display:flex;
        justify-content:space-between;
        gap:8px;
    }
    .btn {
        border-radius:999px;
        border:none;
        padding:9px 18px;
        font-size:0.92rem;
        font-weight:500;
        cursor:pointer;
        display:inline-flex;
        align-items:center;
        gap:6px;
        transition:transform 0.07s ease,box-shadow 0.2s ease,background 0.15s ease,color 0.15s ease;
        white-space:nowrap;
    }
    .btn-primary {
        background:linear-gradient(135deg,#38bdf8,#6366f1);
        color:#0f172a;
        box-shadow:0 14px 30px rgba(56,189,248,0.45);
    }
    .btn-primary:hover {
        transform:translateY(-1px);
        box-shadow:0 18px 40px rgba(56,189,248,0.6);
        background:linear-gradient(135deg,#22c55e,#6366f1);
    }
    .btn-ghost {
        background:transparent;
        color:#e5e7eb;
        border:1px solid rgba(148,163,184,0.7);
    }
    .btn-ghost:hover {
        background:rgba(15,23,42,0.85);
        transform:translateY(-1px);
    }
    .btn:disabled {
        opacity:0.4;
        cursor:default;
        transform:none;
        box-shadow:none;
    }
    .hint {
        margin-top:6px;
        font-size:0.78rem;
        color:#9ca3af;
    }
    .hidden { display:none; }
    #result-card h2 { font-size:1.3rem; }
    .summary {
        margin-top:10px;
        font-size:0.96rem;
        color:#e5e7eb;
    }
    .summary strong { color:#a5b4fc; }
    .list-fails {
        margin-top:12px;
        max-height:220px;
        overflow-y:auto;
        padding-right:6px;
        font-size:0.9rem;
        color:#e5e7eb;
    }
    .list-fails li {
        margin-bottom:8px;
        padding-bottom:6px;
        border-bottom:1px dashed rgba(148,163,184,0.45);
    }
    .retry-row {
        margin-top:16px;
        text-align:center;
    }
    @media (max-width:640px){
        .card{padding:18px 16px 16px;border-radius:18px;}
        h1{font-size:1.2rem;}
        .nav-row{flex-direction:column-reverse;}
        .btn{width:100%;justify-content:center;}
        .progress-label{text-align:left;}
    }
</style>
</head>

<body>
<div class="shell">

<!-- TEST CARD -->
<div id="test-card" class="card">
<div class="card-inner">
    <h1>Single Test ¬∑ Trade, Craftsmanship and Urban Life</h1>
    <div class="tagline">Unit 3 ¬∑ Geography & History ¬∑ 8th Grade (ESO)</div>

    <div class="pill-row">
        <div class="pill">
            <span class="dot"></span>
            <span>Blocks 1, 2 and 3</span>
        </div>
        <div class="pill">
            <span>Practice mode</span>
        </div>
    </div>

    <div class="progress-wrap">
        <div class="progress-bar-bg">
            <div id="progress-bar" class="progress-bar-fill"></div>
        </div>
        <div id="progress-label" class="progress-label"></div>
    </div>

    <div id="question-container" class="question-block"></div>
</div>
</div>

<!-- RESULTS CARD -->
<div id="result-card" class="card hidden">
    <div class="card-inner" id="result-content"></div>
</div>

</div>

<script>
// -------------------------------------------------
// TRANSLATED QUESTIONS
// -------------------------------------------------

const preguntas = [
    // ====== TEST 1 ‚Äì Revival of Trade (15) ======
    {
        tipo: "multi",
        texto: "Between which centuries did the revival of trade in Europe take place?",
        opciones: [
            "Between the 11th and 13th centuries",
            "Between the 8th and 9th centuries",
            "Between the 15th and 16th centuries"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "Which factor encouraged the growth of trade?",
        opciones: [
            "The decline in agricultural production",
            "The appearance of agricultural surpluses and population growth",
            "The prohibition of selling products in markets"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "What were medieval fairs?",
        opciones: [
            "Periodic meetings where products from many regions were exchanged",
            "Religious festivals without trade",
            "Military training grounds"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "Which area did the Italian cities such as Venice and Genoa dominate?",
        opciones: [
            "Trade in the Mediterranean Sea",
            "Trade in the Atlantic Ocean",
            "Trade in the Indian Ocean"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "What was the Hanseatic League?",
        opciones: [
            "A religious order",
            "An association of northern European cities to control trade",
            "An army of mercenaries"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "Which product was NOT typical luxury trade in the Middle Ages?",
        opciones: [
            "Spices and silks",
            "Wheat and rye",
            "Precious stones"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "Which instrument allowed payments without carrying large amounts of money?",
        opciones: [
            "The bill of exchange",
            "The water mill",
            "Parchment"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "What was the name of the new urban social class enriched through trade?",
        opciones: [
            "The feudal nobility",
            "The bourgeoisie",
            "The peasantry"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "What activity did wholesale merchants carry out?",
        opciones: [
            "They sold their products only in a small neighborhood shop",
            "They bought and sold large quantities of products between different regions",
            "They worked as peasants in the countryside"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "What consequence did the growth of trade have on cities?",
        opciones: [
            "The disappearance of medieval cities",
            "Urban population and wealth increased",
            "Fairs and markets were banned"
        ],
        correcta: 1
    },
    {
        tipo: "corta",
        texto: "Write the name of the large periodic gatherings of merchants.",
        respuesta: "fairs"
    },
    {
        tipo: "corta",
        texto: "Write the name of the association of northern European cities that defended their trading interests.",
        respuesta: "Hanseatic League"
    },
    {
        tipo: "corta",
        texto: "Write the name of the document that allowed payments without carrying metal money.",
        respuesta: "bill of exchange"
    },
    {
        tipo: "corta",
        texto: "Write the name of the social group in cities that did not have a joband lived poorly.",
        respuesta: "bmarginalised"
    },
    {
        tipo: "corta",
        texto: "Write the name of an Italian city known for Mediterranean trade.",
        respuesta: "Venice"
    },

    // ====== TEST 2 ‚Äì Development of Craftsmanship (15) ======
    {
        tipo: "multi",
        texto: "What was a guild?",
        opciones: [
            "A marketplace for craft products",
            "An association of people with the same trade",
            "A group of landless peasants"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "From which century did demand for craft products grow?",
        opciones: [
            "From the 10th century",
            "From the 13th century",
            "From the 15th century"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "Where were the workshops of a guild usually located?",
        opciones: [
            "In neighborhoods separated by wealth",
            "In the countryside, far from the city",
            "On the same street, named after the trade"
        ],
        correcta: 2
    },
    {
        tipo: "multi",
        texto: "Who owned the workshop, the tools, and the raw materials?",
        opciones: [
            "The master",
            "The journeyman",
            "The apprentice"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "Which option best describes an apprentice?",
        opciones: [
            "A very wealthy master",
            "An expert worker with a salary",
            "A young person learning the trade without pay, living in the master‚Äôs home"
        ],
        correcta: 2
    },
    {
        tipo: "multi",
        texto: "What did the guild control through the rules of the trade?",
        opciones: [
            "Product quality, raw materials, quality and sale price",
            "The sales and the aid",
            "Weather and harvests"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "Whom did the guild assistance system help?",
        opciones: [
            "Only wealthy masters",
            "The sick, orphans, and widows",
            "Only poor peasants"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "How many levels did the career in the crafts have?",
        opciones: [
            "Three: master, journeyman, and apprentice",
            "Two: master and apprentice",
            "Four: lord, master, journeyman, apprentice"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "What was required to become a master at the end of the 13th century?",
        opciones: [
            "A very high payment to the guild",
            "Having worked only in the countryside",
            "Producing a very difficult masterpiece"
        ],
        correcta: 2
    },
    {
        tipo: "multi",
        texto: "Which statement about women in guilds is correct?",
        opciones: [
            "They were always masters and heads of guilds",
            "They were rarely admitted, but worked in workshops",
            "They could never work in craft trades"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "How were craft products made, according to the text?",
        opciones: [
            "By hand, with few tools, in small workshops",
            "In large factories with machines",
            "Only in fields and villages"
        ],
        correcta: 0
    },
    {
        tipo: "corta",
        texto: "Write the name of the association of people with the same trade.",
        respuesta: "guild"
    },
    {
        tipo: "corta",
        texto: "What is the name of the workshop owner?",
        respuesta: "master"
    },
    {
        tipo: "corta",
        texto: "What is the name of the skilled salaried worker?",
        respuesta: "journeyman"
    },
    {
        tipo: "corta",
        texto: "What is the name of the young person learning the trade?",
        respuesta: "apprentice"
    },
    {
        tipo: "corta",
        texto: "What was the difficult work required to become a master called?",
        respuesta: "masterpiece"
    },

    // ====== TEST 3 ‚Äì Urban Life in the Middle Ages (15) ======
    {
        tipo: "multi",
        texto: "Between which centuries did the urban revival in Europe take place?",
        opciones: [
            "Between the 9th and 10th centuries",
            "Between the 11th and 13th centuries",
            "Between the 14th and 15th centuries"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "Which was one cause of the growth of cities?",
        opciones: [
            "New agricultural techniques required less labor",
            "Cities banned trade",
            "Roads were destroyed"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "What happened to serfs who lived in a city for more than one year?",
        opciones: [
            "They remained serfs",
            "They became free",
            "They became nobles"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "Medieval cities became centers...",
        opciones: [
            "Religious, political, and economic",
            "Only military",
            "Only agricultural"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "What was a city's charter?",
        opciones: [
            "A type of urban tax",
            "A document granting rights and privileges from the king",
            "A defensive wall"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "What was the name of the city's governing body?",
        opciones: [
            "Town council",
            "European Parliament",
            "Feudal court"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "Who formed the urban elite?",
        opciones: [
            "Landless peasants",
            "Rich merchant families, important craftsmen, and high clergy",
            "Only students and scribes"
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        texto: "Which mendicant orders emerged in the cities?",
        opciones: [
            "Franciscan and Dominican",
            "Benedictine and Cistercian",
            "Templar and Hospitaller"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "What were the quarters where Jews and Muslims lived called?",
        opciones: [
            "Jewish and Muslim quarters",
            "Castles and villages",
            "Fields and orchards"
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        texto: "What was the center of urban life?",
        opciones: [
            "The market square",
            "The outer walls",
            "The cemeteries"
        ],
        correcta: 0
    },
    {
        tipo: "corta",
        texto: "What were the inhabitants of the cities called?",
        respuesta: "bourgeoisie"
    },
    {
        tipo: "corta",
        texto: "Write the name of the document that stated a city‚Äôs rights.",
        respuesta: "charter"
    },
    {
        tipo: "corta",
        texto: "Write the name of the urban governing body (one word).",
        respuesta: "council"
    },
    {
        tipo: "corta",
        texto: "Write the name of one mendicant order mentioned in the unit.",
        respuesta: "Franciscans"
    },
    {
        tipo: "corta",
        texto: "What were the neighborhoods where Jews lived called?",
        respuesta: "Jewish quarter"
    }
];

// -------------------------------------------------
// REST OF SCRIPT (unchanged)
// -------------------------------------------------

let orden = [...preguntas.keys()];

function barajar(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}
barajar(orden);

let indice = 0;
let respuestasUsuario = new Array(preguntas.length).fill(null);

function actualizarProgreso() {
    const barra = document.getElementById("progress-bar");
    const label = document.getElementById("progress-label");
    const porcentaje = ((indice + 1) / preguntas.length) * 100;
    barra.style.width = porcentaje + "%";
    label.textContent = `Question ${indice + 1} of ${preguntas.length}`;
}

function normalizarTexto(str) {
    return str
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
}

function renderPregunta() {
    const cont = document.getElementById("question-container");
    const idxPregunta = orden[indice];
    const q = preguntas[idxPregunta];

    actualizarProgreso();

    let html = `
        <div class="question-text">
            ${q.texto}
        </div>
    `;

    if (q.tipo === "multi") {
        html += `<div class="options">`;
        const respGuardada = respuestasUsuario[idxPregunta];
        q.opciones.forEach((op, iOp) => {
            const checked = respGuardada === iOp ? "checked" : "";
            html += `
                <label class="option">
                    <input type="radio" name="resp" value="${iOp}" ${checked}>
                    <div class="option-text">
                        ${op}
                    </div>
                </label>
            `;
        });
        html += `</div>`;
    } else {
        const valor = respuestasUsuario[idxPregunta] ?? "";
        html += `
            <input
                id="short-answer"
                class="short-answer"
                type="text"
                value="${valor}"
                placeholder="Write your answer"
            >
            <div class="hint">1‚Äì2 words are enough</div>
        `;
    }

    html += `
        <div class="nav-row">
            <button class="btn btn-ghost" onclick="anterior()" ${indice === 0 ? "disabled" : ""}>
                ‚óÄ Previous
            </button>
            <button class="btn btn-primary" onclick="siguiente()">
                ${indice === preguntas.length - 1 ? "Finish test" : "Next ‚ñ∂"}
            </button>
        </div>
    `;

    cont.innerHTML = html;
}

function guardarRespuestaActual() {
    const idxPregunta = orden[indice];
    const q = preguntas[idxPregunta];

    if (q.tipo === "multi") {
        const marcada = document.querySelector("input[name='resp']:checked");
        if (!marcada) return false;
        respuestasUsuario[idxPregunta] = parseInt(marcada.value);
        return true;
    } else {
        const input = document.getElementById("short-answer");
        if (!input) return false;
        const valor = input.value.trim();
        if (valor === "") return false;
        respuestasUsuario[idxPregunta] = valor;
        return true;
    }
}

function siguiente() {
    if (!guardarRespuestaActual()) {
        return;
    }
    indice++;
    if (indice >= preguntas.length) {
        mostrarResultados();
    } else {
        renderPregunta();
    }
}

function anterior() {
    if (indice === 0) return;
    indice--;
    renderPregunta();
}

function mostrarResultados() {
    const testCard = document.getElementById("test-card");
    const resultCard = document.getElementById("result-card");
    const resultContent = document.getElementById("result-content");

    testCard.classList.add("hidden");
    resultCard.classList.remove("hidden");

    let correctas = 0;
    const fallos = [];

    preguntas.forEach((q, idx) => {
        const resp = respuestasUsuario[idx];
        if (resp === null) {
            fallos.push(q);
            return;
        }
        if (q.tipo === "multi") {
            if (resp === q.correcta) correctas++;
            else fallos.push(q);
        } else {
            const esperado = normalizarTexto(q.respuesta);
            const dado = normalizarTexto(String(resp));
            if (dado === esperado) {
                correctas++;
            } else {
                fallos.push(q);
            }
        }
    });

    const total = preguntas.length;
    const errores = total - correctas;

    let html = `
        <h2>Test results</h2>
        <div class="summary">
            ‚úÖ Correct answers: <strong>${correctas}</strong><br>
            ‚ùå Mistakes: <strong>${errores}</strong>
        </div>
    `;

    if (fallos.length > 0) {
        html += `<div class="summary" style="margin-top:10px;">
            Questions you should review:
        </div>
        <ul class="list-fails">
        `;
        fallos.forEach(q => {
            html += `
                <li>
                    ${q.texto}
                </li>
            `;
        });
        html += `</ul>`;
    }

    html += `
        <div class="retry-row">
            <button class="btn btn-primary" onclick="location.reload()">
                üîÅ Take the test again
            </button>
        </div>
    `;

    resultContent.innerHTML = html;
}

renderPregunta();
</script>

</body>
</html>

